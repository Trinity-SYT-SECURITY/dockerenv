FROM openjdk:8u111-jdk

ENV CATALINA_INSTALL_HOME /usr/local

ENV TOMCAT_MAJOR 8
ENV TOMCAT_VERSION 8.0.36

COPY ./apache-tomcat-8.0.36.tar.gz ${CATALINA_INSTALL_HOME}/apache-tomcat-8.0.36.tar.gz

RUN cd ${CATALINA_INSTALL_HOME} \
    && tar -xf apache-tomcat-8.0.36.tar.gz \
    && rm -rf apache-tomcat-8.0.36.tar.gz \
    && cd apache-tomcat-8.0.36 \
    && rm -rf bin/*.bat

ENV PATH ${CATALINA_INSTALL_HOME}/apache-tomcat-8.0.36/bin:$PATH
ENV CATALINA_HOME ${CATALINA_INSTALL_HOME}/apache-tomcat-8.0.36
WORKDIR $CATALINA_HOME

COPY ./groovy-2.3.9.jar ${CATALINA_HOME}/lib/groovy-2.3.9.jar
COPY ./tomcat-catalina-jmx-remote-8.0.36.jar ${CATALINA_HOME}/lib/tomcat-catalina-jmx-remote-8.0.36.jar
COPY ./conf/server.xml ${CATALINA_HOME}/conf/server.xml
COPY ./bin/catalina.sh ${CATALINA_HOME}/bin/catalina.sh

RUN chmod 755 ${CATALINA_HOME}/bin/catalina.sh

# smoke test
RUN catalina.sh version

EXPOSE 8080
EXPOSE 10001
EXPOSE 10002

CMD ["catalina.sh", "run"]